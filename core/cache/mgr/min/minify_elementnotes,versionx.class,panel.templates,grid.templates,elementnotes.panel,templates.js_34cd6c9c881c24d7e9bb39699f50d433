var elementNotes=function(config){config=config||{};elementNotes.superclass.constructor.call(this,config);};Ext.extend(elementNotes,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},view:{},keymap:{},plugin:{}});Ext.reg('elementnotes',elementNotes);elementNotes=new elementNotes();;var VersionX=function(config){config=config||{};VersionX.superclass.constructor.call(this,config);};Ext.extend(VersionX,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},tabs:{},combo:{},config:{connector_url:''},inVersion:false});Ext.reg('versionx',VersionX);VersionX=new VersionX();VersionX.panel.VersionHeader=function(config){config=config||{};config.title=config.title||'New Section';Ext.apply(config,{border:false,forceLayout:true,width:'98%',items:[{html:'<h3 style="border-bottom: 1px solid; padding-top: 1em;">'+config.title+'</h3>'}]});VersionX.panel.VersionHeader.superclass.constructor.call(this,config);};Ext.extend(VersionX.panel.VersionHeader,MODx.Panel);Ext.reg('versionx-panel-versionheader',VersionX.panel.VersionHeader);;VersionX.panel.Templates=function(config){config=config||{};Ext.apply(config,{id:'versionx-panel-templates',border:false,forceLayout:true,width:'98%',items:[{layout:'column',border:false,items:[{columnWidth:.5,layout:'form',border:false,items:[{xtype:(VersionX.inVersion)?'hidden':'textfield',fieldLabel:_('template'),name:'fltr_template',width:'95%',id:'tpl-f-template',value:(VersionX.inVersion)?MODx.request.id:''},{xtype:'modx-combo-user',fieldLabel:_('user'),name:'fltr_user',hiddenName:'fltr_user',anchor:'1',id:'tpl-f-user'},{xtype:'datefield',fieldLabel:_('versionx.filter.datefrom'),name:'fltr_from',anchor:'1',id:'tpl-f-from'}]},{columnWidth:.5,layout:'form',border:false,items:[{xtype:(VersionX.inVersion)?'hidden':'modx-combo-category',fieldLabel:_('category'),name:'fltr_category',anchor:'1',id:'tpl-f-category'},{xtype:'datefield',fieldLabel:_('versionx.filter.dateuntil'),name:'fltr_until',anchor:'1',id:'tpl-f-until'}]}]},{layout:'column',padding:'10px 0 0 0',border:false,defaults:{border:false},items:[{width:90,items:[{border:false,html:'&nbsp;'}]},{items:[{xtype:'button',handler:this.doFilter,text:_('versionx.filter',{what:_('templates')})}]},{items:[{xtype:'button',handler:this.resetFilter,text:_('versionx.filter.reset')}]},{columnWidth:1,items:[{html:'&nbsp;',border:false}]}]}],listeners:{'success':function(){}}});VersionX.panel.Templates.superclass.constructor.call(this,config);};Ext.extend(VersionX.panel.Templates,MODx.Panel,{doFilter:function(){var g=Ext.getCmp('versionx-grid-templates');if(g){g.baseParams['search']=Ext.getCmp('tpl-f-template').getValue();g.baseParams['category']=Ext.getCmp('tpl-f-category').getValue();g.baseParams['user']=Ext.getCmp('tpl-f-user').getValue();g.baseParams['from']=Ext.getCmp('tpl-f-from').getValue();g.baseParams['until']=Ext.getCmp('tpl-f-until').getValue();g.getBottomToolbar().changePage(1);g.refresh();}},resetFilter:function(){var g=Ext.getCmp('versionx-grid-templates');g.baseParams['template']=(VersionX.inVersion)?MODx.request.id:'';g.baseParams['category']='';g.baseParams['user']='';g.baseParams['from']='';g.baseParams['until']='';g.getBottomToolbar().changePage(1);g.refresh();Ext.getCmp('tpl-f-template').reset();Ext.getCmp('tpl-f-category').reset();Ext.getCmp('tpl-f-user').reset();Ext.getCmp('tpl-f-from').reset();Ext.getCmp('tpl-f-until').reset();}});Ext.reg('versionx-panel-templates',VersionX.panel.Templates);;VersionX.grid.Templates=function(config){config=config||{};Ext.applyIf(config,{url:VersionX.config.connector_url,id:'versionx-grid-templates',baseParams:{action:'mgr/templates/getlist',template:(VersionX.inVersion)?MODx.request['id']:0},params:[],viewConfig:{forceFit:true,enableRowBody:true,emptyText:_('versionx.error.noresults')},fields:[{name:'version_id',type:'int'},{name:'content_id',type:'int'},{name:'saved',type:'string'},{name:'username',type:'string'},{name:'mode',type:'string'},{name:'marked',type:'boolean'},{name:'templatename',type:'string'},{name:'category',type:'int'},{name:'categoryname',type:'string'}],paging:true,remoteSort:true,columns:[{header:_('versionx.version_id'),dataIndex:'version_id',sortable:true,width:.1},{header:_('versionx.content_id',{what:_('template')}),dataIndex:'content_id',sortable:true,width:.1},{header:_('versionx.saved'),dataIndex:'saved',sortable:true,width:.2},{header:_('versionx.content_name',{what:_('template')}),dataIndex:'templatename',sortable:true,width:.4},{header:_('category'),dataIndex:'categoryname',sortable:true,width:.2},{header:_('user'),dataIndex:'username',sortable:true,width:.2},{header:_('versionx.mode'),dataIndex:'mode',sortable:true,width:.1,renderer:function(val){return _('versionx.mode.'+val);}},{header:_('versionx.marked'),dataIndex:'marked',sortable:true,width:.1,hidden:true}],listeners:{}});VersionX.grid.Templates.superclass.constructor.call(this,config);};Ext.extend(VersionX.grid.Templates,MODx.grid.Grid,{getMenu:function(){var r=this.getSelectionModel().getSelected();var d=r.data;var m=[];m.push({text:_('versionx.menu.viewdetails'),handler:function(){var eid=d.version_id;var backTo=(VersionX.inVersion)?'&backTo='+MODx.request['a']+'-'+MODx.request['id']:'';window.location.href='?a='+VersionX.action+'&action=template&vid='+eid+backTo;}},'-',{text:_('versionx.templates.revert',{id:d.version_id}),handler:function(){this.revertVersion(d.version_id,d.content_id)},scope:this});if(m.length>0){this.addContextMenuItem(m);}},revertVersion:function(version,content){if(version<1){MODx.alert(_('error'),'Version not properly defined: '+version);}
MODx.msg.confirm({title:_('versionx.templates.revert.confirm'),text:_('versionx.templates.revert.confirm.text',{id:version}),url:VersionX.config.connector_url,params:{version_id:version,content_id:content,action:'mgr/templates/revert'},listeners:{success:{fn:function(){MODx.msg.status({message:_('versionx.templates.reverted'),delay:4});},scope:this}}});}});Ext.reg('versionx-grid-templates',VersionX.grid.Templates);;elementNotes.panel.Notes=function(config){config=config||{};Ext.apply(config,{listeners:{render:{fn:function(a){this.getElementNote();},scope:this}},id:'elementnotes-page',items:[{border:false,baseCls:'panel-desc',style:{padding:'5px',margin:'10px 5px 0'},html:'<p>'+_('elementNote_panelDesc')+'</p>'},{border:false,style:{padding:'5px',overflow:'hidden'},layout:'anchor',items:[{xtype:Ext.ComponentMgr.types['modx-texteditor']?'modx-texteditor':'textarea',cls:'elementnotes-note',id:'elementnotes-text',grow:true,growMin:'400',growMax:'500',width:'100%',enableKeyEvents:true,listeners:{keyup:{fn:function(){var button=Ext.getCmp('elementnotes-save-btn');if(this.value!==this.getValue()){if(button.disabled){button.setDisabled(false);}}else{if(!button.disabled){button.setDisabled(true);}}}}}},{xtype:'button',id:'elementnotes-save-btn',text:_('save'),cls:'primary-button',style:{marginTop:'10px'},disabled:true,listeners:{click:{fn:function(){if(this.disabled)return false;var type='';if(MODx.request.a.indexOf('snippet')>0)
type='snippet';else if(MODx.request.a.indexOf('chunk')>0)
type='chunk';else if(MODx.request.a.indexOf('plugin')>0)
type='plugin';else if(MODx.request.a.indexOf('template')>0)
type='template';var text=Ext.getCmp('elementnotes-text').getValue();this.setText(_('saving'));MODx.Ajax.request({url:elemNotes.config.connector_url,params:{action:'mgr/note/save',id:MODx.request.id,type:type,text:text},listeners:{'success':{fn:function(r){if(r.success){this.setDisabled(true);this.setText(_('save'));}},scope:this}}});}}}}]}]});elementNotes.panel.Notes.superclass.constructor.call(this,config);};Ext.extend(elementNotes.panel.Notes,MODx.Panel,{getElementNote:function(){var type='';if(MODx.request.a.indexOf('snippet')>0)
type='snippet';else if(MODx.request.a.indexOf('chunk')>0)
type='chunk';else if(MODx.request.a.indexOf('plugin')>0)
type='plugin';else if(MODx.request.a.indexOf('template')>0)
type='template';MODx.Ajax.request({url:elemNotes.config.connector_url,params:{action:'mgr/note/get',id:MODx.request.id,type:type},listeners:{'success':{fn:function(r){if(r.success){Ext.getCmp('elementnotes-text').setValue(r.object.text);}},scope:this}}});}});Ext.reg('elementnotes-page',elementNotes.panel.Notes);;AdminTools.grid.TemplResources=function(config){config=config||{};if(!config.id){config.id='admintools-templresources-grid';}
Ext.applyIf(config,{url:adminToolsSettings.config.connector_url,fields:this.getFields(config),columns:this.getColumns(config),baseParams:{action:'mgr/resources/getlist',tid:MODx.request.id},listeners:{rowDblClick:function(grid,rowIndex,e){var row=grid.store.getAt(rowIndex);}},viewConfig:{forceFit:true,enableRowBody:true,autoFill:true,showPreview:true,scrollOffset:0,getRowClass:function(rec,ri,p){return rec.data.deleted?'admintools-grid-row-disabled':'';}},paging:true,remoteSort:true,autoHeight:true});AdminTools.grid.TemplResources.superclass.constructor.call(this,config);};Ext.extend(AdminTools.grid.TemplResources,MODx.grid.Grid,{windows:{},getFields:function(config){return['id','pagetitle','description','deleted','published','context_key','uri'];},getColumns:function(config){return[{header:"ID",dataIndex:'id',fixed:true,sortable:true,width:100},{header:_('admintools_title'),dataIndex:'pagetitle',sortable:true,width:200},{header:_('admintools_description'),dataIndex:'description',sortable:false,width:200},{header:'URI',dataIndex:'uri',sortable:false,width:100},{header:_('admintools_context'),dataIndex:'context_key',sortable:false,width:70},{header:_('admintools_published'),dataIndex:'published',renderer:AdminTools.utils.renderBoolean,sortable:false,width:70},{header:_('admintools_deleted'),dataIndex:'deleted',renderer:AdminTools.utils.renderBoolean,sortable:false,width:70}];},getTopBar:function(config){return[{text:'<i class="icon icon-plus"></i>&nbsp;'+_('admintools_create'),handler:this.createResource(),scope:this}];}});Ext.reg('admintools-templresources-grid',AdminTools.grid.TemplResources);Ext.onReady(function(){MODx.addTab("modx-template-tabs",{id:"admintools-resources-tab",title:_('admintools_resources'),items:[{xtype:"admintools-templresources-grid",width:"100%"}]});});